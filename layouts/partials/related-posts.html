{{/* ABOUTME: Displays related posts based on tags and content similarity. */}}
{{/* ABOUTME: Uses Hugo's .Related function to suggest 3-5 relevant articles for better internal linking. */}}

{{- $postDate := .Date -}}
{{- $startDate := $postDate.AddDate -5 0 0 -}}
{{- $endDate := $postDate.AddDate 5 0 0 -}}
{{- $allRelated := .Site.RegularPages.Related . -}}
{{- $related := where (where $allRelated ".Date" "ge" $startDate) ".Date" "le" $endDate | first 5 -}}
{{- with $related -}}
<aside class="related-posts" aria-label="Related posts">
  <h3>{{ i18n "related-posts" | default "Related Posts" }}</h3>
  <ul class="related-posts-list">
    {{- range . -}}
    <li class="related-post-item">
      <a href="{{ .RelPermalink }}" class="related-post-link">
        <span class="related-post-title">{{ .Title }}</span>
        {{- if .Date -}}
        <time datetime="{{ .Date.Format "2006-01-02" }}" class="related-post-date">
          {{ .Date.Format "2006-01-02" }}
        </time>
        {{- end -}}
      </a>
    </li>
    {{- end -}}
  </ul>
</aside>
{{- end -}}
