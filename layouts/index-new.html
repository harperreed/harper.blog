{{ define "main" }}
<div class="max-w-[var(--max-width)] mx-auto px-4 sm:px-6 lg:px-8 py-12">

  {{/* Hero: Latest Post */}}
  {{ $latestPost := (where .Site.RegularPages "Section" "post" | first 1) }}
  {{ with index $latestPost 0 }}
  <section class="mb-16">
    <article class="relative group">
      <a href="{{ .Permalink }}" class="block p-8 md:p-12 rounded-xl bg-[var(--color-bg-secondary)] border border-[var(--color-border)] hover:border-[var(--color-accent)] transition-all">
        <span class="inline-block px-3 py-1 text-xs font-medium uppercase tracking-wider text-[var(--color-accent)] bg-[var(--color-accent)]/10 rounded-full mb-4">
          Latest Post
        </span>
        <h2 class="font-display text-3xl md:text-4xl font-bold leading-tight mb-4 group-hover:text-[var(--color-accent)] transition-colors">
          {{ .Title }}
        </h2>
        <p class="text-lg text-[var(--color-text-secondary)] leading-relaxed mb-6 max-w-prose">
          {{ .Summary | truncate 200 }}
        </p>
        <div class="flex items-center gap-4 text-sm text-[var(--color-text-secondary)]">
          <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "January 2, 2006" }}</time>
          <span>&middot;</span>
          <span>{{ .ReadingTime }} min read</span>
        </div>
      </a>
    </article>
  </section>
  {{ end }}

  {{/* Recent Notes */}}
  {{ $recentNotes := (where .Site.RegularPages "Section" "notes" | first 6) }}
  {{ if $recentNotes }}
  <section class="mb-16">
    <div class="flex items-center justify-between mb-8">
      <h2 class="font-display text-2xl font-bold">Recent Notes</h2>
      <a href="/notes/" class="text-sm font-medium text-[var(--color-accent)] hover:underline">View all &rarr;</a>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {{ range $recentNotes }}
      <article class="group">
        <a href="{{ .Permalink }}" class="block p-6 rounded-lg border border-[var(--color-border)] hover:border-[var(--color-accent)] hover:shadow-md transition-all h-full">
          {{ with .Params.images }}
          {{ $img := index . 0 }}
          <img src="{{ $img }}" alt="" class="w-full h-40 object-cover rounded-md mb-4">
          {{ end }}
          <p class="text-[var(--color-text)] leading-relaxed mb-3">
            {{ with .Description }}{{ . | truncate 120 }}{{ else }}{{ .Title | truncate 120 }}{{ end }}
          </p>
          <time class="text-xs text-[var(--color-text-secondary)]" datetime="{{ .Date.Format "2006-01-02" }}">
            {{ .Date.Format "Jan 2, 2006" }}
          </time>
        </a>
      </article>
      {{ end }}
    </div>
  </section>
  {{ end }}

  {{/* Currently Section */}}
  <section class="mb-16">
    <h2 class="font-display text-2xl font-bold mb-8">Currently</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {{/* Currently Reading */}}
      {{ $currentBook := (where .Site.RegularPages "Section" "books" | first 1) }}
      {{ with index $currentBook 0 }}
      <a href="{{ .Permalink }}" class="flex items-center gap-4 p-4 rounded-lg border border-[var(--color-border)] hover:border-[var(--color-accent)] transition-all">
        <span class="text-2xl">ğŸ“š</span>
        <div>
          <span class="text-xs uppercase tracking-wider text-[var(--color-text-secondary)]">Reading</span>
          <p class="font-medium">{{ .Title }}</p>
        </div>
      </a>
      {{ end }}

      {{/* Recently Listened */}}
      {{ $currentMusic := (where .Site.RegularPages "Section" "music" | first 1) }}
      {{ with index $currentMusic 0 }}
      <a href="{{ .Permalink }}" class="flex items-center gap-4 p-4 rounded-lg border border-[var(--color-border)] hover:border-[var(--color-accent)] transition-all">
        <span class="text-2xl">ğŸµ</span>
        <div>
          <span class="text-xs uppercase tracking-wider text-[var(--color-text-secondary)]">Listening</span>
          <p class="font-medium">{{ .Title }}</p>
        </div>
      </a>
      {{ end }}
    </div>
  </section>

  {{/* Explore Section */}}
  <section>
    <h2 class="font-display text-2xl font-bold mb-8">Explore</h2>
    <div class="flex flex-wrap gap-4">
      {{ range (slice
        (dict "name" "Posts" "url" "/post/" "icon" "âœï¸")
        (dict "name" "Notes" "url" "/notes/" "icon" "ğŸ’­")
        (dict "name" "Books" "url" "/books/" "icon" "ğŸ“š")
        (dict "name" "Music" "url" "/music/" "icon" "ğŸµ")
        (dict "name" "Links" "url" "/links/" "icon" "ğŸ”—")
      ) }}
      <a href="{{ .url }}" class="flex items-center gap-2 px-4 py-2 rounded-full border border-[var(--color-border)] hover:border-[var(--color-accent)] hover:bg-[var(--color-bg-secondary)] transition-all">
        <span>{{ .icon }}</span>
        <span class="font-medium">{{ .name }}</span>
      </a>
      {{ end }}

      {{/* Random Post */}}
      <button id="random-post-btn" class="flex items-center gap-2 px-4 py-2 rounded-full border border-[var(--color-border)] hover:border-[var(--color-accent)] hover:bg-[var(--color-bg-secondary)] transition-all">
        <span>ğŸ²</span>
        <span class="font-medium">Random</span>
      </button>
    </div>
  </section>

</div>

<script>
  // Random post functionality
  document.getElementById('random-post-btn')?.addEventListener('click', () => {
    const posts = {{ .Site.RegularPages | where "Section" "post" | jsonify }};
    if (posts.length > 0) {
      const randomPost = posts[Math.floor(Math.random() * posts.length)];
      window.location.href = randomPost.RelPermalink;
    }
  });
</script>
{{ end }}
