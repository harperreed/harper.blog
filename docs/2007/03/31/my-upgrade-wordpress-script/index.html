
<!DOCTYPE html>
<html>
  <head>
    
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="shortcut icon" href="https://harper.blog/favicon.ico">
      
      <title>My upgrade wordpress script &middot; Writing by Harper Reed</title>
      <meta name="description" content="">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
      <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
      <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-hQpvDQiCJaD2H465dQfA717v7lu5qHWtDbWNPvaTJ0ID5xnPUlVXnKzq7b8YUkbN" crossorigin="anonymous">

      <link rel="alternate" type="application/rss+xml" title="Writing by Harper Reed" href="">
      <meta name="google-site-verification" content="UhNsUFmIygSV6JDvpCaxIJs2mQLgTvuKcFG5epZZiCg" />
      <link rel="stylesheet" href="https://harper.blog/css/main.css">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:image" content="https://harper.blog/images/harper.jpg" />
      <meta name="twitter:site" content="@harper" />
      <meta name="twitter:title" content="My upgrade wordpress script" />
      <meta name="twitter:description" content="I broke my blog the other day. It was a pain in the ass. I don&rsquo;t really know what happened - just that it broke. So I was thinking, I hate upgrading my wordpress. I hate it. I agree 100% with Matt Cutts about how wordpress has one of the most clunky and cruft creating upgrade process. So annoying. And it gets even more annoying when you are doing it with 50 blogs." />


      <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Harper Reed",
      "url": "http://www.harperreed.com",
      "sameAs": [
        "https://instagram.com/harperreed",
        "https://www.linkedin.com/in/harperreed",
        "https://twitter.com/harper"
      ]
    }
      </script>
      
    
  </head>
  <body>
    <div class="container">

    
      <header class="page-header">
        

      <div class="wrapper">
        <ul class="nav nav-pills pull-right">
            
            <li class="presentation">
              <a href="https://harper.blog/about/">About</a>
            </li>
            
            <li class="presentation">
              <a href="https://harper.blog/archives/">Archives</a>
            </li>
            
        </ul>
        <h1><a class="page-title" href="https://harper.blog/"><i class="fa fa-pencil" aria-hidden="true"></i> Writing by Harper Reed</a></h1>
      </div>
    
    </header>



    
    <div class="page-content">
      
<nav>
  <ul class="pager">
    <li class="previous"><a href="https://harper.blog/archives/"><span aria-hidden="true">&larr;</span> Back to Archives</a></li>
  </ul>
</nav>
<div class="post" style="padding-bottom: 50px;">

  <div >
    <h1 ><a title="Permanent Link to My upgrade wordpress script." href="https://harper.blog/2007/03/31/my-upgrade-wordpress-script/" rel="bookmark">My upgrade wordpress script</a> <br /><small>Posted on Mar 31, 2007</small></h1>
  </div>
  <div class="postcontent">
    

<p>I broke my blog the other day. It was a pain in the ass. I don&rsquo;t really know what happened - just that it broke. So I was thinking, I hate upgrading my wordpress. I hate it. I agree 100% with <a href="http://www.mattcutts.com/blog/upgrading-wordpress/">Matt Cutts</a> about how wordpress has one of the most clunky and cruft creating upgrade process. So annoying. And it gets even more annoying when you are doing it with 50 blogs. stupid friends. hah. So awhile ago I created this script which basically lets me just execute a small number of commands to upgrade a wordpress blog.</p>

<p>If a script isn&rsquo;t really your thing, it seems like the best way to handle wordpress upgrades is to use SVN to do them. I am going to look into the best way to do that, but my experience so far in that experiment has shown me that the bleeding edge release of wordpress is not always a working release. ;)</p>

<p><a href="http://photomatt.net/">Matt</a> from wordpress <a href="http://www.mattcutts.com/blog/upgrading-wordpress/#comment-100841">comments</a> on Matt Cutt&rsquo;s blog about the existence of a <a href="http://www.zirona.com/software/wordpress-instant-upgrade/">upgrade plugin</a> - which seems really interesting. hmm..</p>

<p>So anyway. The script&hellip;</p>

<p>I am warning you that this script HAS KILLED AT LEAST ONE BLOG. hah. but it has also regularly upgraded at least 50 blogs as well. So.. use at your own risk. and feel free to modify and fix stuff that you see.</p>

<p>I am assuming that your web layout is:
<blockquote>/ <em>- root of domain</em>
/web <em>- blogs webroot
</em>/archive  <em>- archive for old backups
</em></blockquote>
If your layout differs it will not be too hard to change the vars and make the script work for you. The script will backup your wordpress DB, tar up your wordpress dir, download the newest version of wordpress, untar the new wordpress, and then move all your wp-content and what not into the new wordpress dir. It then puts all the backups into a dated folder in the archive dir. then cleans up a bit after itself.</p>

<p>The script does not account for any customizations at all. If you have any files that are placed in the webroot, or files that are not in their normal places, it will not work at all. Honestly - unless you know what you are doing and really want to play Russian roulette of the bash kind - I wouldn&rsquo;t use this script. ;)
<blockquote>#!/bin/bash</p>

<h1 id="dirs">Dirs</h1>

<p>webdir=&ldquo;web&rdquo;
archivedir=&ldquo;archive&rdquo;</p>

<h1 id="mysql-credentials">Mysql credentials</h1>

<p>database=&ldquo;wordpress mysql database&rdquo;
username=&ldquo;wordpress mysql username&rdquo;
password=&ldquo;wordpress mysql password&rdquo;</p>

<p>#the meat of the script
echo &ldquo;Wordpress upgrade script&rdquo;
echo &ldquo;* Backing up wordpress db&rdquo;
/usr/local/mysql/bin/mysqldump $database -u $username -p$password &gt; sql<em>backup</em><code>date +&quot;%m-%d-%Y&quot;</code>.sql
echo &ldquo;* Gzipping wordpress sql&rdquo;
gzip sql<em>backup</em><code>date +&quot;%m-%d-%Y&quot;</code>.sql
mkdir wordpress.backup_<code>date +&quot;%m-%d-%Y&quot;</code>
mv sql<em>backup</em><code>date +&quot;%m-%d-%Y&quot;</code>.sql.gz wordpress.backup<em><code>date +&quot;%m-%d-%Y&quot;</code>
mkdir wp-backup</em><code>date +&quot;%m-%d-%Y&quot;</code>
cd $webdir
echo &ldquo;* Backing up the old wordpress&rdquo;
tar zcf ../wordpress.backup<em><code>date +&quot;%m-%d-%Y&quot;</code>/$webdir.backup</em><code>date +&quot;%m-%d-%Y-%T&quot;</code>.tgz .
cp -a wp-config.php ../wp-backup<em><code>date +&quot;%m-%d-%Y&quot;</code>
cp -a wp-content ../wp-backup</em><code>date +&quot;%m-%d-%Y&quot;</code>
cp -a wp-images ../wp-backup<em><code>date +&quot;%m-%d-%Y&quot;</code>
cp -a .htaccess ../wp-backup</em><code>date +&quot;%m-%d-%Y&quot;</code>
cd ../wp-backup<em><code>date +&quot;%m-%d-%Y&quot;</code>
echo &ldquo;* Downloading the newest wordpress&rdquo;
wget -q <a href="http://wordpress.org/latest.tar.gz">http://wordpress.org/latest.tar.gz</a>
echo &ldquo;* Extrating the new wordpress&rdquo;
tar zxf latest.tar.gz
cd ..
echo &ldquo;* Doing a bunch of directory and file juggling&rdquo;
mv $webdir wordpress.backup</em><code>date +&quot;%m-%d-%Y&quot;</code>/
mv wordpress.backup<em><code>date +&quot;%m-%d-%Y&quot;</code>/ $archivedir/wordpress.backup</em><code>date +&quot;%m-%d-%Y-%T&quot;</code>
mv wp-backup<em><code>date +&quot;%m-%d-%Y&quot;</code>/wordpress $webdir
cp -af wp-backup</em><code>date +&quot;%m-%d-%Y&quot;</code>/* $webdir/
cp -af wp-backup_<code>date +&quot;%m-%d-%Y&quot;</code>/.htaccess $webdir/</p>

<p>echo &ldquo;* Cleaning up&rdquo;
rm -rf wp-backup<em><code>date +&quot;%m-%d-%Y&quot;</code>/
echo &ldquo;* Backup placed in $archivedir/wordpress.backup</em><code>date +&quot;%m-%d-%Y-%T&quot;</code>&ldquo;</p>

<p>echo &ldquo;All upgraded. Run the upgrade script: /wp-admin/upgrade.php&rdquo;</blockquote>
So you drop this script into your domain root and then execute it. Here is the output from my most recent upgrade.
<blockquote>[jhr@destrukt nata2.org]$ sh wordress_upgrade.sh
Wordpress upgrade script
* Backing up wordpress db
* Gzipping wordpress sql
* Backing up the old wordpress
* Downloading the newest wordpress
* Extrating the new wordpress
* Doing a bunch of directory and file juggling
* Cleaning up
* Backup placed in archive/wordpress.backup_03-31-2007-17:50:04
All upgraded. Run the upgrade script: /wp-admin/upgrade.php
[jhr@destrukt nata2.org]$</blockquote>
Since it completely removes all the old files, except those in wp-content and wp-images it leads to less cruft and nonsense. It simply runs though and does what I would have done with my fingers, but automagically.</p>

<p>You can <a href="http://stuff.harperreed.org/v/code/wordpress_upgrader/f/wordress_upgrade-release.sh">download the script at stuff.harperreed.org</a>.</p>

<p>So there yea go. Its really simple and quite easy. And it works great for upgrading my blogs. Let me know if it worked for you, or if you have any comments or suggestions.
<p class="wlWriterSmartContent" id="0767317B-992E-4b12-91E0-4F059A8CECA8:4aa8b25b-1fa2-4173-bbf9-60825aebbc8f" contenteditable="false" style="margin: 0px; padding: 0px; display: inline">[tags]wordpress, upgrade, script, bash, automatic upgrade, php[/tags]</p></p>

  </div>
</div>

<hr>




<h3>See Also</h3>
<ul>
  
  <li><a href="https://harper.blog/2007/03/28/sad-google-day./">Sad Google day.</a> <small>published on Mar 28, 2007</small></li>
  
  <li><a href="https://harper.blog/2007/03/28/hmm./">hmm.</a> <small>published on Mar 28, 2007</small></li>
  
  <li><a href="https://harper.blog/2007/03/23/memcached-on-skinnycorp/">Memcached on skinnyCorp</a> <small>published on Mar 23, 2007</small></li>
  
  <li><a href="https://harper.blog/2007/03/22/my-birthday-was-awesome/">My birthday was awesome</a> <small>published on Mar 22, 2007</small></li>
  
  <li><a href="https://harper.blog/2007/03/22/watch-this-frank-zappa-interview/">Watch this Frank Zappa interview</a> <small>published on Mar 22, 2007</small></li>
  
</ul>


<hr>

<nav>
  <ul class="pager">
  
    <li class="previous"><a href="https://harper.blog/2007/04/05/new-theme/" title="Previous: New theme"><span aria-hidden="true">&larr;</span> Previous entry </a></li>
  
  
    <li class="next"><a href="https://harper.blog/2007/03/28/sad-google-day./" title="Next: Sad Google day.">Next entry <span aria-hidden="true">&rarr;</span></a></li>
  
  </ul>
</nav>

    </div>
      <footer class="footer">
    
      <br /><br />
        <p class="text-muted small"><b><i class="fa fa-camera-retro" aria-hidden="true"></i> Writing by Harper Reed</b> &middot; Copyright &copy; Harper Reed &middot; Contact <a href="mailto:harper@nata2.org">Harper Reed</a> &middot; Generated @ Nov 25, 2018</p>
    
      </footer>
      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-70650-74', 'auto');
  ga('send', 'pageview');

</script>
  

    </div>
  </body>
</html>
